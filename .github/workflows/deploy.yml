name: CI/CD Pipeline Simplificado

on:
  push:
    branches: [ "main", "dev2" ]
  pull_request:
    branches: [ "main" ]

jobs:
  # ETAPA 1: IntegraciÃ³n Continua (Build & Test)
  ci-logic:
    runs-on: ubuntu-latest

    steps:
    - name: Descargar CÃ³digo
      uses: actions/checkout@v4

    - name: Configurar PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.2'
        extensions: pdo_mysql, mbstring

    - name: Instalar Dependencias (Backend)
      working-directory: ./backend
      run: composer install --no-ansi --no-interaction --no-scripts

    - name: Ejecutar Tests de Calidad
      working-directory: ./backend
      run: |
        cp .env.example .env
        php artisan key:generate
        php artisan test --env=testing
      env:
        DB_CONNECTION: sqlite
        DB_DATABASE: ':memory:'

  # ETAPA 2: Despliegue Continuo (SimulaciÃ³n para DocumentaciÃ³n)
  cd-deploy:
    needs: ci-logic
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest

    steps:
    - name: Simular Despliegue en ProducciÃ³n
      run: |
        echo "ðŸš€ Iniciando despliegue en servidor remoto..."
        echo "ðŸ“¦ Sincronizando archivos..."
        echo "âœ… El proyecto se ha desplegado correctamente (Simulado)."