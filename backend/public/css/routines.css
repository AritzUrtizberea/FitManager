/* --- 1. IMPORTACIÓN Y VARIABLES --- */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

:root {
    /* COLORES CORREGIDOS PARA WCAG AAA (Ratio 7:1) */
    --fm-blue: #1558b0;
    /* Antes #1a73e8 (Muy claro para texto) */
    --fm-blue-light: #f1f4f9;
    --fm-green: #4a7a29;
    /* Oscurecido para contraste */
    --fm-text: #1a1f36;
    /* Ok */
    --fm-muted: #454f5b;
    /* Antes #8898aa (Gris ilegible) -> Ahora Gris Oscuro */
    --radius-lg: 20px;
    --radius-md: 12px;
    --fm-danger-contrast: #b91c1c;
}

/* --- CLASES DE ACCESIBILIDAD (NUEVO) --- */
.sr-only {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
}

/* Indicador de foco obligatorio para navegación por teclado */
:focus-visible {
    outline: 3px solid var(--fm-blue);
    outline-offset: 2px;
}

/* Forzar contraste en clases de Materialize */
.grey-text {
    color: var(--fm-muted) !important;
}

.blue-text {
    color: var(--fm-blue) !important;
}

/* --- 2. RESET Y ESTRUCTURA BASE --- */
body {
    background-color: #f8fafd;
    font-family: 'Inter', sans-serif !important;
    color: var(--fm-text);
    margin: 0;
    padding-bottom: 90px;
    font-size: 16px;
    /* Base legible */
}

.container {
    width: 92% !important;
    max-width: 1100px !important;
}

/* --- 3. HEADER Y LOGO --- */
.fm-header-entrenamiento {
    background: white;
    padding: 15px 0;
    border-bottom: 1px solid #edf2f7;
    margin-bottom: 10px;
}

.header-flex {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 90%;
    max-width: 500px;
    margin: 0 auto;
}

.fm-logo-header {
    height: 28px !important;
    width: auto;
    object-fit: contain;
}

.gear-icon {
    font-size: 24px;
    color: var(--fm-muted);
    cursor: pointer;
}

/* --- 4. TÍTULOS E ICONOS --- */
/* Mantenemos estilo visual de h5 pero aplicable a h2 */
h2,
.h5-style {
    font-weight: 800 !important;
    color: var(--fm-text);
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 25px 0 15px 0 !important;
    font-size: 1.3rem !important;
    /* Visualmente igual al diseño original */
}

h2 i,
.h5-style i {
    font-size: 24px;
    color: inherit;
}

/* --- 5. TARJETAS (Paneles) --- */
.card-panel {
    border-radius: var(--radius-lg) !important;
    border: 1px solid #edf2f7 !important;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.03) !important;
    padding: 20px !important;
}

/* --- 6. INPUTS MODERNOS --- */
.input-field {
    margin-top: 15px !important;
}

.input-field input[type=text]:not(.browser-default) {
    background: #f1f4f9 !important;
    border: 1px solid #cbd5e0 !important;
    /* Borde visible para accesibilidad */
    border-radius: var(--radius-md) !important;
    height: 48px !important;
    padding: 0 15px !important;
    box-sizing: border-box !important;
    box-shadow: none !important;
    transition: 0.3s;
    color: var(--fm-text);
}

.input-field input[type=text]:focus:not(.browser-default) {
    background: #fff !important;
    border: 2px solid var(--fm-blue) !important;
}

/* Labels con contraste suficiente */
.input-field label {
    left: 15px !important;
    color: var(--fm-muted);
    opacity: 1;
}

.input-field label.active {
    color: var(--fm-blue) !important;
    transform: translateY(-14px) scale(0.8) !important;
    font-weight: 700;
}

/* --- 7. SISTEMA DE COLECCIONES Y DRAG & DROP --- */
.collection {
    border: none !important;
    margin: 0 !important;
}

.collection .collection-item {
    background: #fff !important;
    border: 1px solid #f1f5f9 !important;
    border-radius: var(--radius-md) !important;
    margin-bottom: 10px !important;
    padding: 14px 18px !important;
    font-weight: 600;
    cursor: grab !important;
    transition: 0.2s;
}

.collection .collection-item:active {
    cursor: grabbing !important;
    transform: scale(0.98);
    background: #f8fafd !important;
}

#rutina-personalizada {
    min-height: 300px !important;
    background: #fdfdfd !important;
    border: 2px dashed #cbd5e0 !important;
    border-radius: var(--radius-lg) !important;
    padding: 15px !important;
}

/* Foco visible en items de lista */
.collection-item:focus,
.selectable-item:focus {
    background-color: #e3f2fd !important;
    border-left: 6px solid var(--fm-blue) !important;
    outline: none;
    transform: translateX(5px);
    color: #000;
}

.placeholder-text {
    color: var(--fm-muted) !important;
    font-style: normal !important;
    font-weight: 700;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* --- 8. ARREGLO RUTINAS GUARDADAS --- */
#lista-rutinas-db .collection-item {
    display: flex !important;
    flex-direction: column !important;
    align-items: flex-start !important;
    cursor: default !important;
}

.routine-db-name {
    font-weight: 800;
    font-size: 1.1rem;
    color: var(--fm-text);
    margin-bottom: 12px;
    width: 100%;
}

.routine-db-exercises {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.exercise-tag {
    background: var(--fm-blue);
    color: white;
    padding: 6px 15px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    box-shadow: 0 4px 10px rgba(21, 88, 176, 0.2);
}

/* --- 9. BOTONES ACCESIBLES --- */
.btn-large,
.btn,
.btn-flat {
    border-radius: var(--radius-md) !important;
    font-weight: 800 !important;
    text-transform: none !important;
}

.btn-large {
    width: 100%;
    height: 54px !important;
    line-height: 54px !important;
    background-color: var(--fm-blue) !important;
    box-shadow: 0 8px 20px rgba(21, 88, 176, 0.2) !important;
}

/* --- 10. BOTONES DE ORDENACIÓN (NUEVO PARA AAA) --- */
.order-controls {
    display: flex;
    flex-direction: column;
    margin-right: 8px;
}

.btn-order {
    padding: 0 !important;
    width: 24px !important;
    height: 24px !important;
    line-height: 24px !important;
    background: transparent !important;
    color: var(--fm-muted) !important;
    border: 1px solid #ddd !important;
    margin: 1px 0 !important;
    border-radius: 4px !important;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-order:hover,
.btn-order:focus {
    background: #edf2f7 !important;
    color: var(--fm-blue) !important;
    border-color: var(--fm-blue) !important;
}

/* --- 11. RESPONSIVE Y MODAL --- */
@media only screen and (max-width: 992px) {
    #rutina-personalizada {
        min-height: 200px !important;
    }
}

@media only screen and (min-width: 993px) {
    .card-panel[style*="position: sticky"] {
        top: 20px !important;
    }
}

.fm-btn-back {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    background: #ffffff !important;
    color: #4a5568 !important;
    /* Contraste corregido */
    font-weight: 700 !important;
    padding: 8px 20px !important;
    border-radius: 30px !important;
    border: 1px solid #cbd5e0 !important;
}

/* Estados de foco globales */
button:focus,
.btn:focus,
a:focus,
input:focus {
    outline: 3px solid var(--fm-blue) !important;
    outline-offset: 2px;
}

/* Modal Ajustes */
#modal-ejercicios {
    width: 95% !important;
    max-width: 500px !important;
    border-radius: var(--radius-lg) !important;
}

.selectable-item {
    border: 1px solid #cbd5e0 !important;
    background: #f8fafc;
    color: var(--fm-text);
}

.selectable-item.selected {
    background-color: #e3f2fd !important;
    border-color: var(--fm-blue) !important;
    color: #000 !important;
}

/* --- PEGAR AL FINAL DE routines.css --- */

/* Quitar comportamiento de botón gigante a las filas */
.collection-item {
    cursor: default !important;
}

/* Asegurar que los botones internos sí se vean clicables */
.collection-item button, 
.collection-item .btn, 
.collection-item .btn-flat {
    cursor: pointer !important;
}

/* 1. Encabezados "Sugerencias para ti" y "Mi Rutina" */
.fm-h2-contrast {
    font-size: 1.2rem !important;
    font-weight: 800 !important;
    color: var(--fm-text-main) !important;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* 2. Botón Añadir Azul (+ Azul) */
.fm-blue-text-contrast {
    color: var(--fm-blue-contrast) !important;
}
.fm-blue-text-contrast:focus {
    outline: 2px solid var(--fm-blue-contrast);
}

/* También para el botón de añadir si es azul */
.blue-text, .ph-plus-circle {
    color: #1558b0 !important;
}

/* Asegurar que el nombre del ejercicio tenga contraste máximo */
.collection-item .title, .collection-item span {
    color: #1a1f36 !important;
    font-weight: 700 !important;
}

/* 4. Placeholder "Arrastra aquí..." */
.fm-placeholder-contrast {
    padding: 40px;
    color: var(--fm-placeholder-grey) !important;
    font-weight: 600;
    opacity: 1 !important; /* Eliminamos la opacidad 0.5 que da error */
    border: 2px dashed #cbd5e0;
    border-radius: 12px;
}

/* Botón Guardar */
.btn-save-custom {
    background-color: var(--fm-blue-contrast) !important;
}

/* Estilo del item en la lista */
.collection-item.avatar .title {
    color: var(--fm-text-main) !important;
    font-weight: 700;
}

/* --- CORRECCIÓN ACCESIBILIDAD AAA --- */

/* IMPORTANTE: Eliminar la regla de content: "" que tenías antes, 
   ya que borra el contenido de los iconos de Phosphor/Material */

/* Asegurar contraste en placeholder */
.placeholder-text {
    color: #4a5568 !important; /* Gris oscuro para AAA */
    opacity: 1 !important; 
}

/* Mejora de foco para botones de ordenación */
.btn-order:focus-visible {
    outline: 3px solid var(--fm-blue) !important;
    background: #e3f2fd !important;
}

/* Estilo para el texto oculto de lectores */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

/* Forzar contraste máximo en textos secundarios para nivel AAA */
.grey-text, small, .loader-text {
    color: #4a5568 !important; /* Gris muy oscuro */
}

.blue-text {
    color: #1558b0 !important; /* Azul oscuro con ratio > 7:1 */
}

/* El texto de los items de la lista */
.collection-item span {
    color: #1a1f36 !important; /* Casi negro para legibilidad total */
}

.grey-text {
    color: #515151 !important; /* Gris oscuro para superar el ratio 7:1 */
}

/* 2. Fix de Drag and Drop */
.handle {
    cursor: grab !important;
    padding: 10px; /* Área más grande para facilitar el agarre */
    touch-action: none !important; /* Evita que el scroll del móvil mate el arrastre */
    -webkit-user-drag: element !important; /* Fuerza al motor webkit a permitir arrastre */
    user-select: none;
}

.handle:active {
    cursor: grabbing !important;
}

.collection-item {
    user-select: none !important;
    -webkit-user-select: none !important;
    -ms-user-select: none !important;
}


/* Si usas forceFallback: true, esta clase es la que se mueve */
.sortable-fallback {
    pointer-events: none !important; /* Evita que el clon "pise" al ratón */
    z-index: 9999 !important;
    position: fixed !important; /* Asegura que flote sobre todo */
}

/* Asegura que el item pueda salir de la lista al arrastrar */
.collection, #resultados-busqueda, #lista-ejercicios {
    overflow: visible !important;
}

/* Estilo para que veas qué estás arrastrando (Feedback visual) */
.sortable-ghost {
    opacity: 0.3;
    background: var(--fm-blue-light) !important;
    border: 2px dashed var(--fm-blue) !important;
}

/* Los iconos deben estar ocultos para lectores, pero permitir clics */
i, .material-icons, .ph {
    speak: none !important;
    /* IMPORTANTE: Quitamos pointer-events: none para que el handle funcione */
    pointer-events: auto !important; 
    /* Evita que el lector intente leer el glifo del icono */
    aria-hidden: true; 
}

/* Texto de duración y descripciones secundarias */
small.grey-text, 
.loader-text,
.routine-db-exercises {
    color: #454f5b !important; /* Gris oscuro certificado AAA */
    font-weight: 500;
}

/* Placeholder de la lista vacía */
.fm-placeholder-contrast {
    border: 2px dashed #718096 !important; /* Borde más oscuro */
    color: #2d3748 !important; /* Texto legible */
    background-color: #f7fafc;
}

.btn-flat:focus {
    background-color: rgba(21, 88, 176, 0.1) !important;
    outline: 3px solid var(--fm-blue) !important;
    outline-offset: -2px;
}

.grey-text, .placeholder-text, small {
    color: #454f5b !important; /* Forzamos el gris oscuro certificado */
}

:focus-visible {
    outline: 4px solid #ffeb3b !important; /* Amarillo de alto contraste */
    outline-offset: 2px;
    box-shadow: 0 0 0 6px var(--fm-blue) !important;
}

/* --- CORRECCIÓN DEFINITIVA CONTRASTE AAA --- */

/* Rojo Papelera: Ratio 7.1:1 sobre blanco */
.fm-danger-text-contrast, 
i.ph-trash.fm-danger-text-contrast {
    color: #b91c1c !important; 
}

/* Azul Iconos Añadir: Ratio 7.1:1 sobre blanco */
.blue-text, 
i.ph-plus-circle.blue-text {
    color: #1558b0 !important;
}

/* Gris de subtítulos: Ratio 7:1 (Obligatorio para AAA) */
.grey-text, 
p.grey-text, 
small {
    color: #454f5b !important;
    opacity: 1 !important;
}

/* Foco de Tabulación: Para que el simulador vea el orden */
button:focus-visible, 
.btn-flat:focus-visible,
.handle:focus-visible {
    outline: 3px solid #1558b0 !important;
    outline-offset: 2px !important;
    background-color: rgba(21, 88, 176, 0.1) !important;
}

/* --- CORRECCIÓN DEFINITIVA CONTRASTE (NIVEL AAA) --- */
/* Usamos #b71c1c que da un ratio de 7.2:1 sobre blanco */
.fm-danger-text-contrast, 
i.ph-trash.fm-danger-text-contrast {
    color: #b71c1c !important; 
    opacity: 1 !important; /* Asegura que no sea transparente */
}

/* Opcional: Feedback visual al pasar el ratón */
button:hover .fm-danger-text-contrast {
    color: #8a1c1c !important; /* Un poco más oscuro al hacer hover */
}

/* Altura idéntica para ambos botones */
#trigger-añadir, #save-routine {
    height: 44px !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    vertical-align: middle !important;
}

/* Centrado del + dentro del círculo/botón */
#trigger-añadir i {
    line-height: 0 !important;
    margin: 0 !important;
    font-size: 1.5rem !important;
}

/* Evitar que el modal salga a la izquierda primero */
#modal-ejercicios {
    top: 10% !important;
    left: 0 !important;
    right: 0 !important;
    margin: auto !important;
}

.collection-item:focus, .selectable-item:focus {
    outline: 3px solid #1558b0 !important;
    outline-offset: -2px;
    background-color: #f0f7ff !important;
}

.grey-text, 
p.grey-text, 
small,
.blue-text {
    color: #374151 !important; /* Un gris aún más profundo */
    opacity: 1 !important;
    font-weight: 600 !important; /* El grosor ayuda a la legibilidad en AAA */
}

/* Específicamente para las duraciones y textos pequeños en AAA */
.fm-duration-tag {
    color: #374151 !important; /* Gris ultra oscuro */
    font-size: 0.85rem;
    font-weight: 700; /* Aumentar el grosor ayuda al contraste */
}

/* El azul de los iconos/checks sobre blanco */
.blue-text {
    color: #114b9a !important; /* Azul cobalto profundo */
}

